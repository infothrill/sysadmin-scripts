<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>httptraffic.pl - Merge webalizer .hist files into a MySQL database and generate reports</title>
<link rev="made" href="mailto:root@b28.apple.com" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<ul>

		<li><a href="#database_update">Database update</a></li>
		<li><a href="#report_generation">Report generation</a></li>
	</ul>

	<li><a href="#options">OPTIONS</a></li>
	<li><a href="#examples">EXAMPLES</a></li>
	<li><a href="#sql_table">SQL table</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#bugs">BUGS</a></li>
	<li><a href="#copyright_and_license">COPYRIGHT AND LICENSE</a></li>
	<li><a href="#authors">AUTHORS</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>httptraffic.pl - Merge webalizer .hist files into a MySQL database and generate reports</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<p>httptraffic.pl [<strong>-HqvV</strong>] [<strong>-h</strong> hostname] [<strong>-d</strong> database] [<strong>-u</strong> user] [<strong>-p</strong> password] [<strong>-t</strong> tablename] [<strong>-m</strong> month] [<strong>-y</strong> year] <em>basedirectory</em></p>
<p>httptraffic.pl [<strong>-HqvV</strong>] [<strong>-h</strong> hostname] [<strong>-d</strong> database] [<strong>-u</strong> user] [<strong>-p</strong> password] [<strong>-t</strong> tablename] [<strong>-m</strong> month] [<strong>-y</strong> year] [<strong>-r</strong>] <em>domainname</em></p>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p><strong>httptraffic.pl</strong> overcomes a missing feature of webalizer: monitoring
overall statistics for longer than only the last 12 months. It uses
a MySQL database to save and/or analyze the statistics generated
by the webalizer program.</p>
<p>httptraffic.pl has two modes of operation: In database update
mode, it gathers data from history files generated by webalizer and merges
them into the database, and in report generation mode, it generates
reports from the database.</p>
<p>
</p>
<h2><a name="database_update">Database update</a></h2>
<p>In database update mode (the default), httptraffic.pl parses the monthly
history files generated by the <em>webalizer</em> program and
merges the parsed data into a MySQL database.
The input is taken from the specified <em>basedirectory</em> which is supposed
to contain one directory per domain, in which the webalizer output can be found.</p>
<p>Example: If you specify /var/wwwstats/ as the <em>basedirectory</em>, the following history
files will be read:</p>
<pre>
   /var/wwwstats/somedomain.org/webalizer.hist
   /var/wwwstats/outer.galaxy.net/webalizer.hist
   /var/wwwstats/test.com/webalizer.hist
   ...</pre>
<p>httptraffic.pl does not erase records for months older than one year, unlike webalizer does.
In real life, this script can be used to keep monthly records of access statistics generated by
the webalizer program and subsequently use it to generate reports.
If webalizer is run via the cron facility, it is most likely that httptraffic.pl also should be run
via cron.</p>
<p>
</p>
<h2><a name="report_generation">Report generation</a></h2>
<p>The report generation mode is entered by specifying the -r option.
The report can be done for a specific year and/or month and/or for all domains
or only a specific domain. By default, it generates cross-domain totals. If you want to
have a report for a specific domain, simply give the domain name as last
parameter.</p>
<p>
</p>
<hr />
<h1><a name="options">OPTIONS</a></h1>
<dl>
<dt><strong><a name="item__2dd_2c__2d_2ddatabase_database"><strong>-d</strong>, <strong>--database</strong> database</a></strong><br />
</dt>
<dd>
Specify the MySQL database.
</dd>
<p></p>
<dt><strong><a name="item__2dh_2c__2d_2dhost_hostname"><strong>-h</strong>, <strong>--host</strong> hostname</a></strong><br />
</dt>
<dd>
Specify the MySQL hostname.
</dd>
<p></p>
<dt><strong><a name="item__2dh_2c__2d_2dhelp"><strong>-H</strong>, <strong>--help</strong></a></strong><br />
</dt>
<dd>
Print out this documentation (which is done simply by feeding the script to
<code>perldoc -t</code>).
</dd>
<p></p>
<dt><strong><a name="item__2dm_2c__2d_2dmonth_month"><strong>-m</strong>, <strong>--month</strong> month</a></strong><br />
</dt>
<dd>
Specify the month for the report to be generated.
</dd>
<p></p>
<dt><strong><a name="item__2dp_2c__2d_2dpassword_password"><strong>-p</strong>, <strong>--password</strong> password</a></strong><br />
</dt>
<dd>
Specify the MySQL password.
</dd>
<p></p>
<dt><strong><a name="item__2dq_2c__2d_2dquiet"><strong>-q</strong>, <strong>--quiet</strong></a></strong><br />
</dt>
<dd>
Do not print anything. Be quiet.
</dd>
<p></p>
<dt><strong><a name="item__2dr_2c__2d_2dreport"><strong>-r</strong>, <strong>--report</strong></a></strong><br />
</dt>
<dd>
Generate a report. Do not update the database.
</dd>
<p></p>
<dt><strong><a name="item__2dt_2c__2d_2dtable_tablename"><strong>-t</strong>, <strong>--table</strong> tablename</a></strong><br />
</dt>
<dd>
Specify the name of the SQL table. Default: 'httptraffic'.
</dd>
<p></p>
<dt><strong><a name="item__2du_2c__2d_2duser_username"><strong>-u</strong>, <strong>--user</strong> username</a></strong><br />
</dt>
<dd>
Specify the MySQL username.
</dd>
<p></p>
<dt><strong><a name="item__2dv_2c__2d_2dversion"><strong>-v</strong>, <strong>--version</strong></a></strong><br />
</dt>
<dd>
Print the version of <strong>multilog-stamptail</strong> and exit.
</dd>
<p></p>
<dt><strong><a name="item__2dv_2c__2d_2dverbose"><strong>-V</strong>, <strong>--verbose</strong></a></strong><br />
</dt>
<dd>
Print more information during execution.
</dd>
<p></p>
<dt><strong><a name="item__2dy_2c__2d_2dyear_year"><strong>-y</strong>, <strong>--year</strong> year</a></strong><br />
</dt>
<dd>
Specify the year for the report to be generated.
</dd>
<p></p></dl>
<p>
</p>
<hr />
<h1><a name="examples">EXAMPLES</a></h1>
<pre>
   httptraffic.pl --verbose /var/wwwstats/</pre>
<p>will update the database using the webalizer.hist files found within subdirectories of the directory /var/wwwstats/</p>
<pre>
   httptraffic.pl  -r -y 2005</pre>
<p>will generate a cross-domain traffic report for the year 2005</p>
<pre>
   httptraffic.pl  -r -y 2005 example.com</pre>
<p>will generate a monthly traffic report for the domain example.com in the year 2005</p>
<p>
</p>
<hr />
<h1><a name="sql_table">SQL table</a></h1>
<p>This script needs one SQL table with the following structure (in MySQL syntax):</p>
<pre>
   CREATE TABLE `httptraffic` (
     `domain` varchar(255) NOT NULL default '0',
     `month` tinyint(4) NOT NULL default '0',
     `year` int(11) NOT NULL default '0',
     `hits` int(11) NOT NULL default '0',
     `files` int(11) NOT NULL default '0',
     `sites` int(11) NOT NULL default '0',
     `kbytes` int(11) NOT NULL default '0',
     `firstday` tinyint(4) NOT NULL default '0',
     `lastday` tinyint(4) NOT NULL default '0',
     `pages` int(11) NOT NULL default '0',
     `visits` int(11) NOT NULL default '0',
     `mtime` timestamp(14) NOT NULL,
     PRIMARY KEY  (`domain`,`month`,`year`)
   ) TYPE=MyISAM;</pre>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p>See <a href="http://www.mrunix.net/webalizer/">http://www.mrunix.net/webalizer/</a> for information on the webalizer program.</p>
<p>The current version of this program is available from its web page at
<a href="http://spurious.biz/~pkremer/projects/scripting/#perl">http://spurious.biz/~pkremer/projects/scripting/#perl</a>.</p>
<p>
</p>
<hr />
<h1><a name="bugs">BUGS</a></h1>
<p>Report bugs to pkremer [at] spurious [dot] biz</p>
<p>
</p>
<hr />
<h1><a name="copyright_and_license">COPYRIGHT AND LICENSE</a></h1>
<p>Copyright 2005, Paul Kremer.</p>
<p>This program is free software; you may redistribute it and/or modify it
under the same terms as Perl itself.</p>
<p>
</p>
<hr />
<h1><a name="authors">AUTHORS</a></h1>
<p>Paul Kremer &lt;pkremer [at] spurious [dot] biz&gt;</p>

</body>

</html>
